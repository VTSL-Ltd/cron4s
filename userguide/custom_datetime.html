<!DOCTYPE html><html><head><title>Cron4s: Custom DateTime</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Antonio Alonso Dominguez" /><meta name="description" content="Scala CRON Parser" /><meta name="og:image" content="/cron4s/img/poster.png" /><meta name="image" property="og:image" content="/cron4s/img/poster.png" /><meta name="og:title" content="Cron4s: Custom DateTime" /><meta name="title" property="og:title" content="Cron4s: Custom DateTime" /><meta name="og:site_name" content="Cron4s" /><meta name="og:url" content="https://alonsodomin.github.io/cron4s" /><meta name="og:type" content="website" /><meta name="og:description" content="Scala CRON Parser" /><link rel="icon" type="image/png" href="/cron4s/img/favicon.png" /><meta name="twitter:title" content="Cron4s: Custom DateTime" /><meta name="twitter:image" content="/cron4s/img/poster.png" /><meta name="twitter:description" content="Scala CRON Parser" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/cron4s/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/cron4s/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/cron4s/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/cron4s/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/cron4s/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/cron4s/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/cron4s/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/cron4s/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/cron4s/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/cron4s/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/cron4s/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/cron4s/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/cron4s/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/cron4s/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/cron4s/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/cron4s/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/cron4s/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/cron4s/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/cron4s/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/cron4s/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/cron4s/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/cron4s/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/cron4s/" class="brand"><div class="brand-wrapper"></div><span>Cron4s</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="userguide/index.html" title="Getting Started" class="">Getting Started</a></div> <div class="sidebar-nav-item  "><a href="userguide/ast.html" title="The Cron4s AST" class="">The Cron4s AST</a></div> <div class="sidebar-nav-item  "><a href="userguide/time_usage.html" title="Working with Time" class="drop-nested">Working with Time</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="userguide/time_usage/matching.html" title="Matching" class="">Matching</a> <a href="userguide/time_usage/forward_backwards.html" title="Forwards & Backwards" class="">Forwards & Backwards</a></div></div> <div class="sidebar-nav-item  "><a href="userguide/builtin_libs.html" title="Built-in libs" class="">Built-in libs</a></div>          </div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/alonsodomin/cron4s" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/alonsodomin/cron4s" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="alonsodomin" data-github-repo="cron4s"><div class="content-wrapper"><section><p>As already mentioned in <a href="builtin_libs.md">Built-in libs</a>, <strong>cron4s</strong> comes with support for some DateTime libraries
out of the box. But implementations of DateTime are many, both in the JVM and in JavaScript and adding support for all
of them as a <em>batteries included</em> is impossible. Also, asking all the potential users to stick to a very limited range
of libraries to be able to use <strong>cron4s</strong> is quite unrealistic.</p>

<p>To solve this, <strong>cron4s</strong> has a means to allow users to provide with ability to <em>plug-in</em> their favorite library and
get all the profit that the library provides with very little effort. This is due to <strong>cron4s</strong>â€™s typeclass-driven
design and, in fact, there is nothing in the internals of the library tied to the <em>built-in</em> lib support, all of them
are implemented the same way as we are going to see right now.</p>

<h2 id="isdatetime-typeclass"><code class="highlighter-rouge">IsDateTime</code> typeclass</h2>

<p>All comes down to one single (and very simple) typeclass: <code class="highlighter-rouge">cron4s.datetime.IsDateTime</code>. Providing an implicit instance
of this trait is enough to be able to use your favourite library.</p>

<p>As an example, we are going to implement support for a very dummy version of a <em>time</em> object:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">MyTime</span><span class="o">(</span><span class="n">seconds</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">minutes</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">hour</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<p>Now that we have a way of representing time, we need to provide an instance for the <code class="highlighter-rouge">IsDateTime</code> typeclass:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cron4s._</span>
<span class="k">import</span> <span class="nn">cron4s.datetime._</span>

<span class="k">implicit</span> <span class="k">object</span> <span class="nc">MyDateInstance</span> <span class="k">extends</span> <span class="nc">IsDateTime</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">supportedFields</span><span class="o">(</span><span class="n">myTime</span><span class="k">:</span> <span class="kt">MyTime</span><span class="o">)</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">CronField</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">List</span><span class="o">(</span><span class="nc">CronField</span><span class="o">.</span><span class="nc">Second</span><span class="o">,</span> <span class="nc">CronField</span><span class="o">.</span><span class="nc">Minute</span><span class="o">,</span> <span class="nc">CronField</span><span class="o">.</span><span class="nc">Hour</span><span class="o">)</span>
  
  <span class="k">def</span> <span class="n">plus</span><span class="o">(</span><span class="n">myTime</span><span class="k">:</span> <span class="kt">MyTime</span><span class="o">,</span> <span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">unit</span><span class="k">:</span> <span class="kt">DateTimeUnit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span>
  
  <span class="k">def</span> <span class="n">get</span><span class="o">[</span><span class="kt">F</span> <span class="k">&lt;:</span> <span class="kt">CronField</span><span class="o">](</span><span class="n">myTime</span><span class="k">:</span> <span class="kt">MyTime</span><span class="o">,</span> <span class="n">field</span><span class="k">:</span> <span class="kt">F</span><span class="o">)</span><span class="k">:</span> <span class="kt">Either</span><span class="o">[</span><span class="kt">DateTimeError</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">field</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">CronField</span><span class="o">.</span><span class="nc">Second</span> <span class="k">=&gt;</span> <span class="nc">Right</span><span class="o">(</span><span class="n">myTime</span><span class="o">.</span><span class="n">seconds</span><span class="o">)</span>
    <span class="k">case</span> <span class="nc">CronField</span><span class="o">.</span><span class="nc">Minute</span> <span class="k">=&gt;</span> <span class="nc">Right</span><span class="o">(</span><span class="n">myTime</span><span class="o">.</span><span class="n">minutes</span><span class="o">)</span>
    <span class="k">case</span> <span class="nc">CronField</span><span class="o">.</span><span class="nc">Hour</span>   <span class="k">=&gt;</span> <span class="nc">Right</span><span class="o">(</span><span class="n">myTime</span><span class="o">.</span><span class="n">hour</span><span class="o">)</span>
    <span class="k">case</span> <span class="k">_</span>                <span class="k">=&gt;</span> <span class="nc">Left</span><span class="o">(</span><span class="nc">UnsupportedField</span><span class="o">(</span><span class="n">field</span><span class="o">))</span>
  <span class="o">}</span>
  
  <span class="k">def</span> <span class="n">set</span><span class="o">[</span><span class="kt">F</span> <span class="k">&lt;:</span> <span class="kt">CronField</span><span class="o">](</span><span class="n">myTime</span><span class="k">:</span> <span class="kt">MyTime</span><span class="o">,</span> <span class="n">field</span><span class="k">:</span> <span class="kt">F</span><span class="o">,</span> <span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Either</span><span class="o">[</span><span class="kt">DateTimeError</span>, <span class="kt">MyTime</span><span class="o">]</span> <span class="k">=</span> <span class="n">field</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">CronField</span><span class="o">.</span><span class="nc">Second</span> <span class="k">=&gt;</span> <span class="nc">Right</span><span class="o">(</span><span class="n">myTime</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">seconds</span> <span class="k">=</span> <span class="n">value</span><span class="o">))</span>
    <span class="k">case</span> <span class="nc">CronField</span><span class="o">.</span><span class="nc">Minute</span> <span class="k">=&gt;</span> <span class="nc">Right</span><span class="o">(</span><span class="n">myTime</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">minutes</span> <span class="k">=</span> <span class="n">value</span><span class="o">))</span>
    <span class="k">case</span> <span class="nc">CronField</span><span class="o">.</span><span class="nc">Hour</span>   <span class="k">=&gt;</span> <span class="nc">Right</span><span class="o">(</span><span class="n">myTime</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">hour</span> <span class="k">=</span> <span class="n">value</span><span class="o">))</span>
    <span class="k">case</span> <span class="k">_</span>                <span class="k">=&gt;</span> <span class="nc">Left</span><span class="o">(</span><span class="nc">UnsupportedField</span><span class="o">(</span><span class="n">field</span><span class="o">))</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>That should be enough. To be sure that all works we are going to use it with a CRON expression:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">cron</span> <span class="k">=</span> <span class="nc">Cron</span><span class="o">.</span><span class="n">unsafeParse</span><span class="o">(</span><span class="s">"* 5,15,30 6-12 * * ?"</span><span class="o">)</span>
<span class="c1">// cron: CronExpr = CronExpr(*, 5,15,30, 6-12, *, *, ?)
</span><span class="k">val</span> <span class="n">myTime</span> <span class="k">=</span> <span class="nc">MyTime</span><span class="o">(</span><span class="mi">59</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
<span class="c1">// myTime: MyTime = MyTime(59, 15, 10)
</span><span class="n">cron</span><span class="o">.</span><span class="n">next</span><span class="o">(</span><span class="n">myTime</span><span class="o">)</span>
<span class="c1">// res0: Option[MyTime] = None
</span><span class="n">cron</span><span class="o">.</span><span class="n">timePart</span><span class="o">.</span><span class="n">next</span><span class="o">(</span><span class="n">myTime</span><span class="o">)</span>
<span class="c1">// res1: Option[MyTime] = Some(MyTime(0, 30, 10))
</span></code></pre>
</div>

<h2 id="testing">Testing</h2>

<p>Running a series of expressions in a REPL is not enough to be 100% confident that our implementation is correct.
<strong>cron4s</strong> provides with the <code class="highlighter-rouge">cron4s-testkit</code> module which includes laws and base test classes to help in this task.
To start using it, just include it in your dependencies:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.github.alonsodomin.cron4s"</span> <span class="o">%%</span> <span class="s">"cron4s-testkit"</span> <span class="o">%</span> <span class="s">"0.6.1"</span> <span class="o">%</span> <span class="nc">Test</span>
</code></pre>
</div>

<p>The first thing to to is to provide an implementation of the <code class="highlighter-rouge">cron4s.testkit.DateTimeTestKitBase</code> trait, this
is meant to instruct <strong>cron4s</strong> on how to create arbitrary instances of your date time object:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cron4s.testkit.DateTimeTestKitBase</span>

<span class="k">trait</span> <span class="nc">MyTimeTestBase</span> <span class="k">extends</span> <span class="nc">DateTimeTestKitBase</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">createDateTime</span><span class="o">(</span><span class="n">seconds</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">minutes</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">hours</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">dayOfMonth</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">month</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">year</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">MyTime</span> <span class="o">=</span>
    <span class="nc">MyTime</span><span class="o">(</span><span class="n">seconds</span><span class="o">,</span> <span class="n">minutes</span><span class="o">,</span> <span class="n">hours</span><span class="o">)</span>

<span class="o">}</span>
</code></pre>
</div>

<p>Also, to be able to perform assertions, <strong>cron4s</strong> needs an instance of the <code class="highlighter-rouge">cats.Eq</code> and <code class="highlighter-rouge">cats.Show</code> type classes:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.</span><span class="o">{</span><span class="nc">Eq</span><span class="o">,</span> <span class="nc">Show</span><span class="o">}</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">myTimeEq</span><span class="k">:</span> <span class="kt">Eq</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Eq</span><span class="o">.</span><span class="n">fromUniversalEquals</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">]</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">myTimeShow</span><span class="k">:</span> <span class="kt">Show</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Show</span><span class="o">.</span><span class="n">fromToString</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">]</span>
</code></pre>
</div>

<p>Now define a spec for your <code class="highlighter-rouge">IsDateTime</code> instance (along with your other test sources):</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cron4s.testkit.IsDateTimeTestKit</span>

<span class="k">class</span> <span class="nc">MyTimeSpec</span> <span class="k">extends</span> <span class="nc">IsDateTimeTestKit</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">](</span><span class="s">"MyTime"</span><span class="o">)</span> <span class="k">with</span> <span class="nc">MyTimeTestBase</span>
</code></pre>
</div>

<p>This will test that your implementation of the <code class="highlighter-rouge">IsDateTime</code> typeclass abides by its laws. To be fully covered is also
recommended to verify that the different CRON expressions work correctly with your date time library. In this case
we will be defining a class extending from <code class="highlighter-rouge">cron4s.testkit.DateTimeCronTestKit</code>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cron4s.testkit.DateTimeCronTestKit</span>

<span class="k">class</span> <span class="nc">MyTimeCronSpec</span> <span class="k">extends</span> <span class="nc">DateTimeCronTestKit</span><span class="o">[</span><span class="kt">MyTime</span><span class="o">]</span> <span class="k">with</span> <span class="nc">MyTimeTestBase</span>
</code></pre>
</div>

<p>And thatâ€™s all, now those tests will be run along any other test sources in your project.</p>
</section></div></div></div></div><script src="/cron4s/highlight/highlight.pack.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'alonsodomin/cron4s'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/cron4s/js/docs.js"></script></body></html>